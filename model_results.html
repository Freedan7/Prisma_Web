<!DOCTYPE html>
<html lang="en">
<?php
        include 'RestCurl.php';
        $ptID=$_GET['ptID'];
        $docID=$_GET['user'];
        $url = "http://localhost:8081/PrismaRestWS/rest/WebService/patientPrediction?doctorId=".$docID."&patientId=".$ptID;
        $patient_details = $curl->getData($url);
        $patient_details = json_decode($patient_details,true);
?>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-1.9.1.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <script src="js/bootstrap.min.js"></script>
    <!--<link href="css/common.css" rel="stylesheet" media="screen">-->
	<link rel="stylesheet" href="css/prismaStyle.css" />

	
    <script>
        var patient_details = [{
            "outcomeRankPositiveList": [{
                "value": "",
                "id": "A1H46215",
                "description": "hemoglobin measured on admission day",
                "weight": 20.704,
                "actual": "",
                "var": "hgb",
                "pr1Description": null,
                "mdcDescription": null,
                "rank": 1
            }, {
                "value": "",
                "id": "A1H46215",
                "description": "base creatinine",
                "weight": 8.421,
                "actual": "",
                "var": "cr_base",
                "pr1Description": null,
                "mdcDescription": null,
                "rank": 2
            }, {
                "value": "",
                "id": "A1H46215",
                "description": "estimated baseline creatinine with mdrd equation",
                "weight": 4.78,
                "actual": "",
                "var": "mdrd_cr",
                "pr1Description": null,
                "mdcDescription": null,
                "rank": 3
            }, {
                "value": "",
                "id": "A1H46215",
                "description": "surgery type",
                "weight": 0.807,
                "actual": "Non-Cardiac General Surgery",
                "var": "service",
                "pr1Description": null,
                "mdcDescription": null,
                "rank": 4
            }, {
                "value": "",
                "id": "A1H46215",
                "description": "attending doctor",
                "weight": 0.72,
                "actual": "raj",
                "var": "attend_doc",
                "pr1Description": null,
                "mdcDescription": null,
                "rank": 5
            }],
            "outcomeRankNegativeList": [{
                "value": "",
                "id": "A1H46215",
                "description": "hematocrit measured on admission day",
                "weight": 12.037,
                "actual": "",
                "var": "hct",
                "pr1Description": null,
                "mdcDescription": null,
                "rank": 57
            }, {
                "value": "",
                "id": "A1H46215",
                "description": "estimated gfr-epi",
                "weight": 11.478,
                "actual": "",
                "var": "egfr_epi",
                "pr1Description": null,
                "mdcDescription": null,
                "rank": 56
            }, {
                "value": "",
                "id": "A1H46215",
                "description": "no blood",
                "weight": 6.348,
                "actual": "",
                "var": "noblood",
                "pr1Description": null,
                "mdcDescription": null,
                "rank": 55
            }, {
                "value": "",
                "id": "A1H46215",
                "description": "age",
                "weight": 3.347,
                "actual": "45",
                "var": "age",
                "pr1Description": null,
                "mdcDescription": null,
                "rank": 54
            }, {
                "value": "yes",
                "id": "A1H46215",
                "description": "diabetes",
                "weight": 1.666,
                "actual": "1",
                "var": "diabetes",
                "pr1Description": null,
                "mdcDescription": null,
                "rank": 53
            }],
            "label": "RIFLE-AKI occurring in the first seven postoperative days",
            "outcome": "0.7592312"
        }, {
            "outcomeRankPositiveList": [{
                "value": "no",
                "id": "A1H46215",
                "description": "receiving betablokers on admission day",
                "weight": 3.845,
                "actual": "0",
                "var": "betablockers_adm",
                "pr1Description": null,
                "mdcDescription": null,
                "rank": 1
            }, {
                "value": "",
                "id": "A1H46215",
                "description": "estimated baseline creatinine with mdrd equation",
                "weight": 3.58,
                "actual": "",
                "var": "mdrd_cr",
                "pr1Description": null,
                "mdcDescription": null,
                "rank": 2
            }, {
                "value": "",
                "id": "A1H46215",
                "description": "surgery type",
                "weight": 2.371,
                "actual": "Non-Cardiac General Surgery",
                "var": "service",
                "pr1Description": null,
                "mdcDescription": null,
                "rank": 3
            },
                {
                "value": "",
                "id": "A1H46215",
                "description": "age",
                "weight": 1.976,
                "actual": "45",
                "var": "age",
                "pr1Description": null,
                "mdcDescription": null,
                "rank": 4
            }, {
                "value": "",
                "id": "A1H46215",
                "description": "hematocrit measured on admission day",
                "weight": 1.755,
                "actual": "",
                "var": "hct",
                "pr1Description": null,
                "mdcDescription": null,
                "rank": 5
            }],
            "outcomeRankNegativeList": [{
                "value": "yes",
                "id": "A1H46215",
                "description": "diabetes",
                "weight": 7.092,
                "actual": "1",
                "var": "diabetes",
                "pr1Description": null,
                "mdcDescription": null,
                "rank": 57
            }, {
                "value": "",
                "id": "A1H46215",
                "description": "no blood",
                "weight": 4.413,
                "actual": "",
                "var": "noblood",
                "pr1Description": null,
                "mdcDescription": null,
                "rank": 56
            }, {
                "value": "no",
                "id": "A1H46215",
                "description": "receiving antiemetic on admission day",
                "weight": 4.04,
                "actual": "0",
                "var": "antiemetic_adm",
                "pr1Description": null,
                "mdcDescription": null,
                "rank": 55
            }, {
                "value": "",
                "id": "A1H46215",
                "description": "hemoglobin measured on admission day",
                "weight": 3.57,
                "actual": "",
                "var": "hgb",
                "pr1Description": null,
                "mdcDescription": null,
                "rank": 54
            }, {
                "value": "",
                "id": "A1H46215",
                "description": "area",
                "weight": 1.23,
                "actual": "",
                "var": "area",
                "pr1Description": null,
                "mdcDescription": null,
                "rank": 53
            }],
            "label": "Admission to ICU more than two days",
            "outcome": "0.3986"
        }]

        submit = function () {
          console.log(dataset);
          window.location.href = "script.php?dataset="+dataset;
        };
    </script>
</head>
<body>
<br />
<!-- This is block to show modal -->
<div class="modal fade" id="modelWindow" role="dialog">
    <div class="modal-dialog modal-sm vertical-align-center">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Main factors contributing to patients risk</h4>
            </div>
            <div class="modal-body">
                <table id="prediction-table" class="table">
                    <thead>
                        <th >Factors Increasing Risk</th>
                        <th >Factors Decreasing Risk</th>
                    </thead>
                </table>
                <button class="btn btn-default" data-toggle="button" data-active-class="success">
                </button>
            </div>
            <div class="modal-footer">
                <button type="button" data-dismiss="modal" class="btn btn-default">Close</button>
            </div>
        </div>
    </div>
</div>

<!---->
		<nav class="navbar navbar-default navbar-static-top">
		  	<div class="container">
				<div class="navbar-header">
				</div>
				<br>
				<h1 id="header" style="text-align: center">UF Health</h1>
				<br>
				<br>
		  		</div>
		</nav>
		
		<div id="envelope" class="container" align="center" >
	        <div id="reviewFeatures">
	        	<br>
        		The computer algorithms have calculated the following probability risk scores
        		<br>
        		<div id="chart"></div>
        		<br>
        		<script src="http://d3js.org/d3.v3.min.js"></script>
        		<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
        		<script src="predictionChart.js"></script>

    		</div>
    		<button id="submit" class="btn btn-primary btn-large" onclick="submit()">SUBMIT</button>
    		<br>
    		<br>
    	</div>
<!---->

<br>
<script>
    generatechart(patient_details)
</script>
</body>
</html>